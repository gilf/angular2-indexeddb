"use strict";var __decorate=this&&this.__decorate||function(e,t,r,o){var n,a=arguments.length,i=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(i=(a<3?n(i):a>3?n(t,r,i):n(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),AngularIndexedDB=function(){function e(e,t){this.utils=new Utils,this.dbWrapper=new DbWrapper(e,t)}return e.prototype.createStore=function(e,t){var r=this,o=this;return new Promise(function(n,a){r.dbWrapper.dbVersion=e;var i=r.utils.indexedDB.open(r.dbWrapper.dbName,e);i.onsuccess=function(e){o.dbWrapper.db=i.result,n()},i.onerror=function(e){a("IndexedDB error: "+e.target.errorCode)},i.onupgradeneeded=function(e){t(e,o.dbWrapper.db)}})},e.prototype.getByKey=function(e,t){var r=this;return new Promise(function(o,n){r.dbWrapper.validateBeforeTransaction(e,n);r.dbWrapper.createTransaction({storeName:e,dbMode:r.utils.dbMode.readOnly,error:function(e){n(e)},complete:function(e){}}).objectStore(e).get(t).onsuccess=function(e){o(e.target.result)}})},e.prototype.getAll=function(e,t,r){var o=this;return new Promise(function(n,a){o.dbWrapper.validateBeforeTransaction(e,a);var i,c=o.dbWrapper.createTransaction({storeName:e,dbMode:o.utils.dbMode.readOnly,error:function(e){a(e)},complete:function(e){}}).objectStore(e),d=[];if(r){var u=c.index(r.indexName),s="desc"===r.order?"prev":"next";i=u.openCursor(t,s)}else i=c.openCursor(t);i.onerror=function(e){a(e)},i.onsuccess=function(e){var t=e.target.result;t?(d.push(t.value),t.continue()):n(d)}})},e.prototype.add=function(e,t,r){var o=this;return new Promise(function(n,a){o.dbWrapper.validateBeforeTransaction(e,a),o.dbWrapper.createTransaction({storeName:e,dbMode:o.utils.dbMode.readWrite,error:function(e){a(e)},complete:function(e){n({key:r,value:t})}}).objectStore(e).add(t,r).onsuccess=function(e){r=e.target.result}})},e.prototype.update=function(e,t,r){var o=this;return new Promise(function(n,a){o.dbWrapper.validateBeforeTransaction(e,a),o.dbWrapper.createTransaction({storeName:e,dbMode:o.utils.dbMode.readWrite,error:function(e){a(e)},complete:function(e){n(t)},abort:function(e){a(e)}}).objectStore(e).put(t,r)})},e.prototype.delete=function(e,t){var r=this;return new Promise(function(o,n){r.dbWrapper.validateBeforeTransaction(e,n),r.dbWrapper.createTransaction({storeName:e,dbMode:r.utils.dbMode.readWrite,error:function(e){n(e)},complete:function(e){o()},abort:function(e){n(e)}}).objectStore(e).delete(t)})},e.prototype.openCursor=function(e,t,r){var o=this;return new Promise(function(n,a){o.dbWrapper.validateBeforeTransaction(e,a),o.dbWrapper.createTransaction({storeName:e,dbMode:o.utils.dbMode.readOnly,error:function(e){a(e)},complete:function(e){n()},abort:function(e){a(e)}}).objectStore(e).openCursor(r).onsuccess=function(e){t(e),n()}})},e.prototype.clear=function(e){var t=this;return new Promise(function(r,o){t.dbWrapper.validateBeforeTransaction(e,o),t.dbWrapper.createTransaction({storeName:e,dbMode:t.utils.dbMode.readWrite,error:function(e){o(e)},complete:function(e){r()},abort:function(e){o(e)}}).objectStore(e).clear(),r()})},e.prototype.getByIndex=function(e,t,r){var o=this;return new Promise(function(n,a){o.dbWrapper.validateBeforeTransaction(e,a),o.dbWrapper.createTransaction({storeName:e,dbMode:o.utils.dbMode.readOnly,error:function(e){a(e)},abort:function(e){a(e)},complete:function(e){}}).objectStore(e).index(t).get(r).onsuccess=function(e){n(e.target.result)}})},e}();AngularIndexedDB=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[String,Number])],AngularIndexedDB),exports.AngularIndexedDB=AngularIndexedDB;var Utils=function(){return function(){this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.dbMode={readOnly:"readonly",readWrite:"readwrite"}}}(),DbWrapper=function(){function e(e,t){this.dbName=e,this.dbVersion=t||1,this.db=null}return e.prototype.validateStoreName=function(e){return this.db.objectStoreNames.contains(e)},e.prototype.validateBeforeTransaction=function(e,t){this.db||t("You need to use the createStore function to create a database before you query it!"),this.validateStoreName(e)||t("objectStore does not exists: "+e)},e.prototype.createTransaction=function(e){var t=this.db.transaction(e.storeName,e.dbMode);return t.onerror=e.error,t.oncomplete=e.complete,t.onabort=e.abort,t},e}();
//# sourceMappingURL=angular2-indexeddb.min.js.map